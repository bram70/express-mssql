/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","jquery.sap.global","sap/ui/demokit/demoapps/model/sourceFileDownloader","sap/m/library","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(C,$,s,m,M,F,a){"use strict";return C.extend("sap.ui.demokit.demoapps.controller.Root",{onTilePress:function(e){var r=e.getSource().data("ref");if(r!=="DOWNLOAD"){m.URLHelper.redirect(r,true);}else{this._downloadTile=e.getSource();var d=this.byId("downloadDialog");d.getBinding("items").filter([]);d.open();}},onLiveChange:function(e){e.getParameters().itemsBinding.filter([new F("name",a.Contains,e.getParameters().value)]);},onDownloadPress:function(e){var l=e.getParameters().selectedItem;var d=this._downloadTile;d.setBusy(true);sap.ui.require(["sap/ui/core/util/File","sap/ui/thirdparty/jszip"],function(b){var z=new JSZip();$.getJSON(l.data("config"),function(c){var f=c.files,p=[],g=[];f.forEach(function(h){var P=s(c.cwd+h);P.then(function(o){if(o.errorMessage){g.push(o.errorMessage);}else{z.file(h,o);}});p.push(P);});Promise.all(p).then(function(){if(g.length){var h=g.reduce(function(E,i){return E+i+"\n";},"Was not able to locate the following files:\n");M.error(h);}var o=z.generate({type:"blob"});d.setBusy(false);b.save(o,l.getTitle(),"zip","application/zip");});});});}});});
