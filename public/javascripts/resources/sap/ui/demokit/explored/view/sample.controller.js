/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/Device','sap/ui/core/Component','sap/ui/core/ComponentContainer','sap/ui/core/HTML','sap/ui/core/UIComponent','sap/ui/core/mvc/Controller','sap/ui/core/routing/History','sap/ui/model/json/JSONModel','sap/m/library','sap/m/Text','../util/ToggleFullScreenHandler','../data'],function(q,D,C,a,H,U,b,c,J,m,T,d,e){"use strict";return b.extend("sap.ui.demokit.explored.view.sample",{onInit:function(){this.router=U.getRouterFor(this);this.router.attachRoutePatternMatched(this.onRouteMatched,this);this._viewModel=new J({showNavButton:true,showNewTab:false});this.getView().setModel(this._viewModel);},onRouteMatched:function(E){if(E.getParameter("name")!=="sample"){return;}var M=this._viewModel.getData();this._sId=E.getParameter("arguments").id;var s=e.samples[this._sId];if(!s){this.router.myNavToWithoutHash("sap.ui.demokit.explored.view.notFound","XML",false,{path:this._sId});return;}var p=this.getView().byId("page");var h=c.getInstance();var P=h.getPreviousHash();M.showNavButton=D.system.phone||!!P;M.previousSampleId=s.previousSampleId;M.nextSampleId=s.nextSampleId;p.setTitle("Sample: "+s.name);try{var o=this._createComponent();}catch(f){p.removeAllContent();p.addContent(new T({text:"Error while loading the sample: "+f}));return;}var g=(this._oComp.getMetadata())?this._oComp.getMetadata().getConfig():null;var S=g&&g.sample||{};M.showNewTab=!!S.iframe;if(S.iframe){o=this._createIframe(S.iframe);}else{this.sIFrameUrl=null;}var i=!!S.stretch;var j=i?"100%":null;p.setEnableScrolling(!i);if(o.setHeight){o.setHeight(j);}p.removeAllContent();p.addContent(o);p.scrollTo(0);this._viewModel.setData(M);},onNewTab:function(){m.URLHelper.redirect(this.sIFrameUrl,true);},onPreviousSample:function(E){this.router.navTo("sample",{id:this._viewModel.getProperty("/previousSampleId")},true);},onNextSample:function(E){this.router.navTo("sample",{id:this._viewModel.getProperty("/nextSampleId")},true);},_createIframe:function(i){var s=this._sId,r=/\/([^\/]*)$/,f=/\..+$/,F,g,h;if(typeof i==="string"){F=r.exec(i);g=(F&&F.length>1?F[1]:i);h=f.exec(g)[0];var I=i.replace(f,"");I=q.sap.getModulePath(s+"."+I,h||".html");var S=window.location.search,t="sap-ui-theme="+sap.ui.getCore().getConfiguration().getTheme();if(S){var R=/sap-ui-theme=[a-z0-9\-]+/;if(S.match(R)){S=S.replace(R,t);}else{S+="&"+t;}}else{S="?"+t;}this.sIFrameUrl=I+S;}else{q.sap.log.error("no iframe source was provided");return;}var o=sap.ui.getCore().byId("sampleFrame");if(o){o.destroy();}o=new H({id:"sampleFrame",content:'<iframe src="'+this.sIFrameUrl+'" id="sampleFrame" frameBorder="0"></iframe>'}).addEventDelegate({onAfterRendering:function(){o.$().on("load",function(){var j=o.$()[0].contentWindow;j.sap.ui.getCore().attachInit(function(){var j=o.$()[0].contentWindow;j.sap.ui.getCore().applyTheme(sap.ui.getCore().getConfiguration().getTheme());j.jQuery('body').toggleClass("sapUiSizeCompact",q("body").hasClass("sapUiSizeCompact")).toggleClass("sapUiSizeCozy",q("body").hasClass("sapUiSizeCozy"));});});}});return o;},_createComponent:function(){var s='sampleComp-'+this._sId;var f=this._sId;this._oComp=sap.ui.component(s);if(this._oComp){this._oComp.destroy();}this._oComp=sap.ui.getCore().createComponent({id:s,name:f});return new a({component:this._oComp});},onNavBack:function(E){if(this._oComp&&this._oComp.exit){this._oComp.exit();}this.router.myNavBack("home",{});},onNavToCode:function(f){this.router.navTo("code",{id:this._sId},false);},onToggleFullScreen:function(E){d.updateMode(E,this.getView());}});});
