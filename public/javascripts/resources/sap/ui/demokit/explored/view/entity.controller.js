/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/Device","sap/ui/core/Component","sap/ui/core/UIComponent","sap/ui/core/routing/History","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/demokit/EntityInfo","sap/ui/demokit/util/JSDocUtil","../util/ObjectSearch","../util/ToggleFullScreenHandler","../data"],function(q,D,C,U,H,a,J,E,b,O,T,d){"use strict";return a.extend("sap.ui.demokit.explored.view.entity",{descriptionText:function(t){var h;if(t){h="<span>"+t+"</span>";}return h;},onInit:function(){this.router=U.getRouterFor(this);this.router.attachRoutePatternMatched(this.onRouteMatched,this);this._component=C.getOwnerComponentFor(this.getView());this.getView().attachBrowserEvent("click",this.onJSDocLinkClick,this);},onExit:function(){this.getView().detachBrowserEvent("click",this.onJSDocLinkClick,this);},onTypeLinkPress:function(e){var t=e.getSource().data("type");this.router.navTo("entity",{id:t,part:"samples"},false);this._component.getEventBus().publish("app","selectEntity",{id:t});},onJSDocLinkClick:function(e){var t=e.target.getAttribute("data-sap-ui-target");if(t&&t.indexOf('#')>=0){t=t.slice(0,t.indexOf('#'));}if(t){this.router.navTo("entity",{id:t,part:"samples"},false);this._component.getEventBus().publish("app","selectEntity",{id:t});e.preventDefault();}},onIntroLinkPress:function(e){var p=document.location.pathname.split("/"),B=document.location.origin+p.splice(0,p.length-1).join("/")+"/";window.open(B+this.getView().getModel().getProperty("/docuLink"),"_blank");},onTabSelect:function(e){var t=e.getParameter("key");this.router.navTo("entity",{id:this._sId,part:t},true);},onNavBack:function(e){this.router.myNavBack("home",{});},onNavToSample:function(e){var p=e.getSource().getBindingContext("entity").getPath();var s=this.getView().getModel("entity").getProperty(p);this.router.navTo("sample",{id:s.id});},_TAB_KEYS:["samples","about","properties","aggregations","associations","events","methods"],onRouteMatched:function(e){var r=e.getParameter("name"),n=e.getParameter("arguments").id,N=e.getParameter("arguments").part;if(r!=="entity"){return;}var o=this.getView().getModel("entity");var p=O.getEntityPath(o.getData(),n);var c=(p)?o.getProperty(p):null;var f=!!p;var h=H.getInstance();var P=h.getPreviousHash();var s=D.system.phone||(!f&&!!P);this.getView().byId("page").setShowNavButton(s);var g;if(this._sId!==n){var i=E.getEntityDocu(n);if(!c&&!i){this.router.myNavToWithoutHash("sap.ui.demokit.explored.view.notFound","XML",false,{path:n});return;}g=this._getViewData(n,i,c);var m=new J(g);this.getView().setModel(m);this.getView().bindElement("entity>"+p);this._sId=n;}else{g=this.getView().getModel().getData();}if(this._TAB_KEYS.indexOf(N)===-1){N="samples";}if(!g.show[N]){N="samples";}var t=this.getView().byId("tabBar");if(N!==t.getSelectedKey()&&t.getExpanded()){t.setSelectedKey(N);}},onToggleFullScreen:function(e){T.updateMode(e,this.getView());},_getViewData:function(i,o,e){var c=this._convertEntityInfo(i,o),s=false,S=0;if(e){if(!c.shortDescription&&e.description){c.shortDescription=e.description;}if(e.docuLink){c.show.introLink=true;c.docuLink=e.docuLink;}s=e.samples.length>0;S=e.samples.length;}c.show.samples=s;c.count.samples=S;return c;},_convertEntityInfo:function(I,o){var c={name:I,deprecated:(o)?this._formatDeprecated(o.deprecation):null,deprecatedMark:(o)?this._createDeprecatedMark(o.deprecation):null,baseType:(o)?this._formatType(o.baseType):null,baseTypeText:(o)?this._formatTypeText(o.baseType):"-",baseTypeNav:(o)?this._formatTypeNav(o.baseType):null,shortDescription:(o)?this._formatDeprecatedDescription(o.deprecation):null,description:(o)?this._wrapInSpanTag(o.doc):null,docuLink:null,properties:[],events:[],methods:[],aggregations:[],associations:[],values:[],show:{baseType:(o)?!!o.baseType:false,about:!!o,properties:false,events:false,methods:false,aggregations:false,associations:false,values:false,introActive:false},count:{properties:0,events:0,methods:0,aggregations:0,associations:0},appComponent:this._takeControlComponent(I)};var m=0,e=0;var B=I.slice(I.lastIndexOf('.')+1);if(!o){return c;}var k=null;for(k in o.properties){if(o.properties.hasOwnProperty(k)&&k.indexOf("_")!==0){var P=o.properties[k];P.name=k;P.deprecatedDescription=this._formatDeprecatedSinceDescription(P.deprecation,P.deprecationSince);P.deprecated=this._formatDeprecated(P.deprecation);P.doc=this._wrapInSpanTag(P.doc);P.typeText=this._formatTypeText(P.type);P.typeNav=this._formatTypeNav(P.type);P.type=this._formatType(P.type);P.defaultValue=(P.defaultValue)?String(P.defaultValue).replace("empty/undefined","-"):"";c.properties.push(P);}}for(k in o.events){if(o.events.hasOwnProperty(k)&&k.indexOf("_")!==0){var f=o.events[k];f.name=k;f.deprecatedDescription=this._formatDeprecatedDescription(f.deprecation);f.deprecated=this._formatDeprecated(f.deprecation);f.doc=this._wrapInSpanTag(f.doc);c.events.push(f);e++;for(var p in f.parameters){if(f.parameters.hasOwnProperty(p)&&p.indexOf("_")!==0){c.events.push({param:p,since:f.parameters[p].since,typeText:this._formatTypeText(f.parameters[p].type),typeNav:this._formatTypeNav(f.parameters[p].type),type:this._formatType(f.parameters[p].type),doc:this._wrapInSpanTag(f.parameters[p].doc),deprecatedDescription:this._formatDeprecatedDescription(f.parameters[p].deprecation),deprecated:this._formatDeprecated(f.parameters[p].deprecation)});}}}}for(k in o.methods){if(o.methods.hasOwnProperty(k)&&k.indexOf("_")!==0&&!o.methods[k].synthetic){var M=o.methods[k];M.name=o.methods[k].static?B+"."+k:k;M.deprecatedDescription=this._formatDeprecatedDescription(M.deprecation);M.deprecated=this._formatDeprecated(M.deprecation);M.doc=this._wrapInSpanTag(M.doc);M.param="returnValue";M.typeText=this._formatTypeText(M.type);M.typeNav=this._formatTypeNav(M.type);M.type=this._formatType(M.type);c.methods.push(M);m++;for(var i=0;i<M.parameters.length;i++){var s=M.parameters[i].name;if(s.indexOf("_")!==0){c.methods.push({param:s,since:M.parameters[i].since,typeText:this._formatTypeText(M.parameters[i].type),typeNav:this._formatTypeNav(M.parameters[i].type),type:this._formatType(M.parameters[i].type),doc:this._wrapInSpanTag(M.parameters[i].doc),deprecatedDescription:this._formatDeprecatedDescription(M.parameters[i].deprecation),deprecated:this._formatDeprecated(M.parameters[i].deprecation)});}}}}for(k in o.aggregations){var A=o.aggregations[k];var n=(!A.hasOwnProperty("visibility")||A.visibility!=="hidden");if(o.aggregations.hasOwnProperty(k)&&k.indexOf("_")!==0&&n){A.name=k;A.deprecated=this._formatDeprecated(A.deprecation);A.deprecatedDescription=this._formatDeprecatedDescription(A.deprecation);A.doc=this._wrapInSpanTag(A.doc);A.typeText=this._formatTypeText(A.type);A.typeNav=this._formatTypeNav(A.type);A.type=this._formatType(A.type);c.aggregations.push(A);}}for(k in o.associations){if(o.associations.hasOwnProperty(k)&&k.indexOf("_")!==0){var g=o.associations[k];g.name=k;g.deprecatedDescription=this._formatDeprecatedDescription(g.deprecation);g.deprecated=this._formatDeprecated(g.deprecation);g.doc=this._wrapInSpanTag(g.doc);g.typeText=this._formatTypeText(g.type);g.typeNav=this._formatTypeNav(g.type);g.type=this._formatType(g.type);c.associations.push(g);}}for(k in o.values){if(o.values.hasOwnProperty(k)&&k.indexOf("_")!==0){var v=o.values[k];v.name=k;v.deprecatedDescription=this._formatDeprecatedDescription(v.deprecation);v.deprecated=this._formatDeprecated(v.deprecation);c.values.push(v);}}c.show.properties=c.properties.length>0;c.show.events=e>0;c.show.methods=m>0;c.show.aggregations=c.aggregations.length>0;c.show.associations=c.associations.length>0;c.show.values=c.values.length>0;c.count.properties=c.properties.length;c.count.events=e;c.count.methods=m;c.count.aggregations=c.aggregations.length;c.count.associations=c.associations.length;return c;},_wrapInSpanTag:function(t){return'<span class="fs0875">'+b.formatTextBlock(t,{linkFormatter:function(c,e){var p;c=c.trim().replace(/\.prototype\./g,"#");p=c.indexOf("#");if(p===0){return"<code>"+c.slice(1)+"</code>";}if(p>0){e=e||c;c=c.slice(0,p);}return"<a class=\"jsdoclink\" href=\"javascript:void(0);\" data-sap-ui-target=\""+c+"\">"+(e||c)+"</a>";}})+'</span>';},_formatDeprecated:function(s){return(s&&s.length>0)?"true":"false";},_formatDeprecatedDescription:function(s){return(this._isDeprecated(s))?(this._createDeprecatedMark(s)+": "+s):null;},_formatDeprecatedSinceDescription:function(s,c){return(this._isDeprecated(s))?(this._createDeprecatedSinceMark()+" "+c+": "+s):null;},_isDeprecated:function(s){return(s&&s.length>0);},_formatType:function(t){if(!t){return null;}else{return t.replace("[]","");}},_formatTypeText:function(t){if(!t){return null;}else{t=t.replace("sap.ui.core.","");var i=t.lastIndexOf(".");return(i!==-1)?t.substr(i+1):t;}},_createDeprecatedMark:function(s){return(s)?this._getI18nModel().getProperty("deprecated"):"";},_createDeprecatedSinceMark:function(){return this._getI18nModel().getProperty("deprecatedSince");},_getI18nModel:function(){return this.getView().getModel("i18n");},_baseTypes:["sap.ui.core.any","sap.ui.core.object","sap.ui.core.function","sap.ui.core.number","sap.ui.core.float","sap.ui.core.int","sap.ui.core.boolean","sap.ui.core.string","sap.ui.core.URI","sap.ui.core.ID","sap.ui.core.void","sap.ui.core.CSSSize","any","object","function","float","int","boolean","string"],_formatTypeNav:function(t){return this._baseTypes.indexOf(t)===-1;},_takeControlComponent:function(c){var l=d.libComponentInfos;q.sap.require("sap.ui.core.util.LibraryInfo");var L=sap.ui.require("sap/ui/core/util/LibraryInfo");var o=new L();var A=o._getActualComponent(l,c);return A;}});});
